import{s as Z,c as A,o as J,d as K}from"../chunks/CHokvJ-H.js";import{S as Q,i as X,d as g,B as V,w as E,v as L,a as k,D as F,l as ee,F as te,G as ae,b as x,k as P,c as M,j as C,E as $,s as T,e as S,C as j,h as _,g as oe}from"../chunks/DjQ7aYyS.js";import{v as se,a as ne,r as ie,l as re,C as le,V as R,s as ce,b as z,c as de,d as me,e as ue,L as pe,F as he,S as fe,A as we,f as ge}from"../chunks/BSkMa5_B.js";import{i as O,R as B,v as G,w as N,V as W,ag as be,o as I,ah as ve,x as ye,E as xe,an as _e,ao as ke,af as Me,aa as Se}from"../chunks/5ecB4tJ3.js";import{G as Y}from"../chunks/Br_SFkwl.js";import{w as Ee}from"../chunks/v_KfRiR6.js";import{i as Le}from"../chunks/SzQcKhoD.js";const Pe=(c,r)=>{const s=new Y,t=new O,a=t.load("/viracocha_inca/textures/defaultMat_baseColor.png");a.encoding=void 0,a.flipY=!1,a.wrapS=B,a.wrapT=B;const u=t.load("/viracocha_inca/textures/defaultMat_metallicRoughness.png");u.flipY=!1;const i=t.load("/viracocha_inca/textures/defaultMat_normal.png");i.flipY=!1,s.load("/viracocha_inca/scene.gltf",n=>{const d=new G({map:a,metalnessMap:u,roughnessMap:u,normalMap:i,metalness:.1,roughness:1,normalScale:new W(1,1),side:N,transparent:!0,alphaTest:.5});n.scene.traverse(l=>{l.isMesh&&(l.material=d)});const p=.036;n.scene.scale.set(p,p,p),n.scene.position.set(0,11,-161),n.scene.rotation.y=Math.PI*2,c.add({name:"viracocha",object:n.scene})},void 0,n=>{console.error("error loading viracocha:",n)})};function Te(c,r,s="/test.mp4"){const t=document.createElement("video");t.src=s,t.loop=!0,t.playsInline=!0,t.width=1400,t.height=640,t.autoplay=!1,se.subscribe(o=>{console.log("Video source changed:",o),t.src=o,t.load()}),ne.subscribe(o=>{o?(t.play().catch(h=>console.error("Play failed:",h)),console.log("video is playing")):(console.log("video is paused"),t.pause())});const a=document.createElement("button");a.innerHTML="▶️ Play",a.style.position="fixed",a.style.bottom="30px",a.style.left="240px",a.style.zIndex="1000",a.style.color="white",a.style.fontSize="1.3rem",a.addEventListener("click",()=>{t.paused?(t.play().catch(o=>console.error("Play failed:",o)),a.innerHTML="Pause ⏸️ "):(t.pause(),a.innerHTML="Play ▶️")}),document.body.appendChild(a),t.addEventListener("error",o=>{console.error("Video error:",t.error)}),t.addEventListener("loadeddata",()=>{console.log("Video loaded successfully")});const u=new be(t);u.minFilter=I,u.magFilter=I;const i=new ve(38,20),n=new ye({map:u,side:N}),d=new xe(i,n);d.position.set(-c.width/2+.2,c.height*1.7,-c.depth/2+21.7),d.rotation.y=Math.PI/2,r.scene.add(d);const p=100;let l=!1;const e=new _e;d.userData.checkProximity=(o,h)=>{const w=d.position.distanceTo(o);e.setFromCamera(new W(0,0),h);const b=e.intersectObject(d);b.length>0&&w<p?a.style.display="block":a.style.display="none";const y=w<p&&b.length>0;y&&!l?(console.log("video is now visible"),l=!0):!y&&l&&(console.log("video is no longer visible"),l=!1)},r.add({name:"videoScreen",object:d,update:function(o){if(this.frameCount===void 0&&(this.frameCount=0),this.frameCount++,this.frameCount%5!==0)return;const h=r.things.find(w=>w.name==="player");h!=null&&h.object&&this.object.userData.checkProximity(h.object.position,r.camera)}})}let m,H;const f={width:34*3.3,depth:107*3.99,height:4*1.5,thickness:1},Ce=(c,r)=>{window.CANNON=le,window.THREE=ke,window.VG=R,m=new R(window,c),m.run();const s=new Me({canvas:c});s.setSize(window.innerWidth,window.innerHeight),m.renderer=s;const t=new O,a=ce(f);m.add(a),m.input.onDown.c=i=>{m.gui.show(m.gui._hidden)},m.input.onDown.h=i=>{m.hudEnabled=!m.hudEnabled},m.add({name:"world",unremovable:!0});{var u={name:"settings",unremovable:!0};m.add(u)}m.add({name:"camera",unremovable:!0});{const i=z(m,t,r,f);H=de(m,{position:{x:-f.width*.3,y:1.5,z:-f.depth*.46},look:{x:.31,y:-.3},room:{width:f.width,depth:f.depth},onUpdate:n=>i(n)}),me(m,H)}ue(m,{width:f.width,depth:f.depth,height:f.height*9,thickness:f.thickness},t),new Y().load("/hangar.glb",function(n){const d=new G({color:12632256,roughness:.7,metalness:1});n.scene.traverse(function(v){v.isMesh&&(v.material=d)});const p=f.depth,l=f.height,e=new Se().setFromObject(n.scene);e.max.x-e.min.x;const o=e.max.z-e.min.z,h=e.max.y-e.min.y,w=l/h,b=p/o,y=Math.min(w,b)*6.8;for(let v=0;v<3;v++){const D=n.scene.clone();D.scale.set(y*1.2,y,y);const U=(v-1)*p/3;D.position.set(0,2,U),m.add({name:`hangar_${v+1}`,object:D})}},void 0,function(n){console.error("Error loading GLTF file",n),alert("Failed to load the 3D model. Please check the path or file.")}),z(m,t,r,f),Pe(m),Te(f,m)},Ve=(c,r)=>{Ce(c,r)},Fe=()=>{m.things.find(r=>r.name==="smiley")?console.log("smiley already exists, not creating a new one"):re(m,H,f)},q=()=>{console.log("removeSmileyFaceWrapper"),ie(m)},$e=Ee(null);function je(c){let r,s,t,a,u,i,n,d,p=`<a class="px-11 flex items-center gap-1" href="/stappen/20" data-sveltekit-reload="">till Stäppen
          <svg class="w-9 h-9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke="currentColor" fill="none" stroke-width="1.5" d="M14 6l6 6-6 6"></path></svg></a>`,l,e;return a=new fe({props:{loadSmiley:Fe,removeSmiley:q}}),i=new we({}),{c(){r=S("div"),s=S("nav"),t=S("div"),j(a.$$.fragment),u=T(),j(i.$$.fragment),n=T(),d=S("div"),d.innerHTML=p,this.h()},l(o){r=M(o,"DIV",{class:!0});var h=C(r);s=M(h,"NAV",{class:!0});var w=C(s);t=M(w,"DIV",{class:!0});var b=C(t);$(a.$$.fragment,b),b.forEach(g),u=P(w),$(i.$$.fragment,w),n=P(w),d=M(w,"DIV",{class:!0,"data-svelte-h":!0}),oe(d)!=="svelte-hgmj4f"&&(d.innerHTML=p),w.forEach(g),h.forEach(g),this.h()},h(){x(t,"class","flex space-x-2 ml-11"),x(d,"class","text-white bg-gradient-to-r from-green-500 to-green-700 font-bold text-xl py-7 left-0"),x(s,"class","flex space-x-[20rem] justify-between w-full items-center"),x(r,"class",l="fixed backdrop-blur-lg bottom-0 w-full z-50 flex items-center justify-between border-t-[1px] border-white/20 "+(c[1]?"block":"hidden")+" md:block")},m(o,h){k(o,r,h),_(r,s),_(s,t),F(a,t,null),_(s,u),F(i,s,null),_(s,n),_(s,d),e=!0},p(o,h){(!e||h&2&&l!==(l="fixed backdrop-blur-lg bottom-0 w-full z-50 flex items-center justify-between border-t-[1px] border-white/20 "+(o[1]?"block":"hidden")+" md:block"))&&x(r,"class",l)},i(o){e||(L(a.$$.fragment,o),L(i.$$.fragment,o),e=!0)},o(o){E(a.$$.fragment,o),E(i.$$.fragment,o),e=!1},d(o){o&&g(r),V(a),V(i)}}}function De(c){let r,s,t,a,u,i,n,d,p,l=!c[2]&&je(c);return a=new pe({}),i=new he({}),{c(){l&&l.c(),r=T(),s=S("canvas"),t=T(),j(a.$$.fragment),u=T(),j(i.$$.fragment),this.h()},l(e){l&&l.l(e),r=P(e),s=M(e,"CANVAS",{class:!0}),C(s).forEach(g),t=P(e),$(a.$$.fragment,e),u=P(e),$(i.$$.fragment,e),this.h()},h(){x(s,"class","w-full h-full fixed top-0 left-0")},m(e,o){l&&l.m(e,o),k(e,r,o),k(e,s,o),c[7](s),k(e,t,o),F(a,e,o),k(e,u,o),F(i,e,o),n=!0,d||(p=ee(s,"click",te(ae(c[3]))),d=!0)},p(e,[o]){e[2]||l.p(e,o)},i(e){n||(L(l),L(a.$$.fragment,e),L(i.$$.fragment,e),n=!0)},o(e){E(l),E(a.$$.fragment,e),E(i.$$.fragment,e),n=!1},d(e){e&&(g(r),g(s),g(t),g(u)),l&&l.d(e),c[7](null),V(a,e),V(i,e),d=!1,p()}}}function Ae(c,r,s){let t,a;A(c,$e,e=>s(9,e)),A(c,ge,e=>s(6,t=e)),A(c,Le,e=>s(1,a=e));let{data:u}=r,i,n;const d=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);J(()=>{Ve(i,u.artworks),s(5,n=new Audio(t)),n.addEventListener("ended",()=>{q()})});const p=async e=>{await i.requestPointerLock({unadjustedMovement:!0})};function l(e){K[e?"unshift":"push"](()=>{i=e,s(0,i)})}return c.$$set=e=>{"data"in e&&s(4,u=e.data)},c.$$.update=()=>{c.$$.dirty&96&&n&&s(5,n.src=t,n)},[i,a,d,p,u,n,t,l]}class Ne extends Q{constructor(r){super(),X(this,r,Ae,De,Z,{data:4})}}export{Ne as component};
